---
title: "MaxEnt Toolbox"
author: "Oakology"
date: "January 11, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


Scenario Selection

```{r extent_selection}

#Change scenario- one thing to change throughout
scenario<-"MainlandCA"

#Options:
#allislands_270m
#ni_270m
#sca_270m
#sca_int_270m
#scr_270m
#sri_270m
#sri_adultyoung_270m
#sri_seedsap_270m
#scr_fog_270m
#sri_fog_270m
#sri_fog_adultyoung_270m
#sri_fog_seedsap_270m
#MainlandCA

#Slope ones?
#Historic ranches?

#Make combine sections based on extents chosen because greatly differs-otherwise just have a lot of if else statements

```

Load Packages

```{r packages, message=FALSE}

#If packages missing use install.packages("packagename")
library(tidyverse)
library(sf)
library(raster)
library(sp)
library(rgdal)
library(tools)
#library(maptools)
#library(dismo)

```


Extent

```{r extent}

#Create scenario extent that will be used throughout the rest of the processes, based off the minimum BCM data available as well as the Channel Island CUSP outlines

#If else statements for scenarios: read in the correct data for each scenario
if (scenario=="allislands_270m"){
  #All Islands
  scenario_extent<-read_sf("G:/data/islands/all_islands/Channel_Islands_CUSP/Channel_Islands_CUSP_Teale_Albers/Channel_Islands_CUSP_Teale_Albers.shp")
  min_data<-raster("G:/data/climate/GISModel_Input/historic/cwd1981_2010_ave_HST_1539127145.tif")
}else if (scenario=="ni_270m"){
  #Northern Islands
  scenario_extent<-read_sf("G:/data/islands/all_islands/ni_outline/ni_outline.shp")
  min_data<-raster("G:/data/climate/GISModel_Input/historic/cwd1981_2010_ave_HST_1539127145.tif")
}else if (scenario=="scr_270m"|scenario=="scr_fog_270m"){
  #Santa Cruz
  scenario_extent<-read_sf("G:/data/islands/scr/scr_extent/scr_extent.shp")
  min_data<-raster("G:/data/climate/GISModel_Input/historic/cwd1981_2010_ave_HST_1539127145.tif")
}else if (scenario=="sri_270m"|scenario=="sri_adultyoung_270m"|scenario=="sri_seedsap_270m"|scenario=="sri_fog_270m"|scenario=="sri_fog_adultyoung_270m"|scenario=="sri_fog_seedsap_270m"){
  #Santa Rosa
  scenario_extent<-read_sf("G:/data/islands/sri/sri_extent/sri_extent.shp")
  min_data<-raster("G:/data/climate/GISModel_Input/historic/cwd1981_2010_ave_HST_1539127145.tif")
}else if (scenario=="sca_270m"){
  #Santa Catalina
  scenario_extent<-read_sf("G:/data/islands/sca/sca_extent/sca_extent.shp")
  min_data<-raster("G:/data/climate/GISModel_Input/historic/cwd1981_2010_ave_HST_1539127145.tif")
}else if (scenario=="sca_int_270m"){
  #Santa Catalina Interpolated
  scenario_extent<-read_sf("G:/data/islands/sca/sca_extent/sca_extent.shp")
  min_data<-raster("G:/data/climate/GIS_Input_SCAInterpolated/historic/cwd1981_2010_ave_HST_1539127145.tif")
}else if (scenario=="MainlandCA"){
  #Mainland CA
  scenario_extent<-raster("G:/data/climate/GISModel_Input/historic/cwd1981_2010_ave_HST_1539127145.tif")
  min_data<-raster("G:/data/climate/GISModel_Input/historic/cwd1981_2010_ave_HST_1539127145.tif")
}else
  print ("No Scenario Selected")

cropped <- crop(min_data, extent(scenario_extent)) #Crop to extent of outlines
extent <- mask(cropped, scenario_extent) #Mask to the exact island outline(s)
writeRaster(extent, filename=paste0("G:/data/islands/MaxEnt/Extent/", scenario, ".tif"), overwrite=TRUE)#write extent raster

#Extent will be used throughout Script. Will call in the extent each time just to be careful.

```


Oak Combined and Individual ***Come back to this

```{r}
#Oak Points

#If else statements for scenarios: read in the correct data for each scenario
if (scenario=="allislands_270m"){
  #All Islands
  
}else if (scenario=="ni_270m"){
  #Northern Islands
 
}else if (scenario=="scr_270m"|scenario=="scr_fog_270m"){
  #Santa Cruz

}else if (scenario=="sri_270m"|scenario=="sri_adultyoung_270m"|scenario=="sri_seedsap_270m"|scenario=="sri_fog_270m"|scenario=="sri_fog_adultyoung_270m"|scenario=="sri_fog_seedsap_270m"){
  #Santa Rosa

}else if (scenario=="sca_270m"){
  #Santa Catalina

}else if (scenario=="sca_int_270m"){
  #Santa Catalina Interpolated

}else if (scenario=="MainlandCA"){
  #Mainland CA

}else
  print ("No Scenario Selected")




#Make sure oak points made first

#SCAOakPoints<-"G:\data\islands\sca\Quertome\SCAOakPoints_AEA.shp"

#SRIOakPoints<-"G:\data\islands\sri\OakPoint\SRI_OakPoints_AEA.shp"
  
#SCROakPoints<-"G:\data\islands\scr\OakPoint\SCROakPoints_AEA.shp"

#Merge all the oak points and save as below shape file

#merge_all_oak<-"G:\data\islands\MaxEnt\Processing\Oak\merge_all_oak.shp"

#Add xy coordinates

#Add field called Species
#Calulate Field- fill with "quercus tomentella"


#Table to Table

#OakWorkspace<-G:\data\islands\MaxEnt\MEInputOak\all_islands_100m
#OutputTable<-OakPoints.csv

#Save to Oak Workspace plus output table


#Also create options for oak points individuals

#comebine based on scenario

#Maybe for loop?

#if all islands then merge all three
#if north islands combine two
#If one island than that island
#if SRI subset then by the oak seed or sap category

```



Climate

```{r}


scenarios<-c("ni_270m","sca_270m","sca_int_270m","scr_270m","sri_270m","sri_adultyoung_270m","sri_seedsap_270m","scr_fog_270m","sri_fog_270m","sri_fog_adultyoung_270m","sri_fog_seedsap_270m","MainlandCA")

for(scen in scenarios){
print(scen)
 scenario<-scen

if (scenario=="sca_int_270m"){
  #Santa Catalina Interpolated
  clim_dirs<-list.dirs(path="G:/data/climate/GIS_Input_SCAInterpolated", full.names=F, recursive=F)
}else
clim_dirs<-list.dirs(path="G:/data/climate/GISModel_Input", full.names=T, recursive=F)

#Call in appropriate extent
extent<-raster(paste0("G:/data/islands/MaxEnt/Extent/", scenario, ".tif"))
crs(extent)<-CRS('+init=epsg:3310') 
 
for (clim in clim_dirs){
  #print (clim) #For loop through climate projections
  clim_vars<-list.files(clim, pattern='tif$', full.names=TRUE )
  for (var in clim_vars){
    #print (var)#For loop through climate variables
    clim_ras<-raster(var)
    crs(clim_ras)<-CRS('+init=epsg:3310')
    clim_crop <- crop(clim_ras, extent(extent)) #Crop to extent of outlines
    climate <- mask(clim_crop, extent) #Mask to the exact island outline(s)
    fn <- paste0("G:/data/climate/MEInput/", scenario, "/", basename(clim), "/", file_path_sans_ext(basename(var)), ".asc")
    writeRaster(climate,fn,format="ascii",overwrite=T)
  }#End for loop through climate variables
}#End for loop through climate projections

}#Running all the scenarios at once

```



Island

```{r}

#Write these out by not using them??? Make them all but then only carry over to MaxEnt folders the files being used-change that in BCM_organization script, slash add BCM_organization script here

#For loop throug

#Soils-take what Claire has?
#Polygon to raster, crop by extent, save as raster asc

#DEM
#Merge if all islands otherwise keep separate?-mosaic to new raster
#Crop by extent 
#calculate Slope, Aspect
#Save all three as new DEMs

#Vegetation
#Make sure vegetation scripts run first and vegetation groups made
#Polygon to Raster for each island
#Merge if all islands otherwise keep separate-mosaic to new raster for ai or ni
#Crop by extent
#Write asc raster

#If else statements for scenarios: read in the correct data for each scenario
if (scenario=="allislands_270m"){
  #All Islands
  
}else if (scenario=="ni_270m"){
  #Northern Islands
 
}else if (scenario=="scr_270m"|scenario=="scr_fog_270m"){
  #Santa Cruz

}else if (scenario=="sri_270m"|scenario=="sri_adultyoung_270m"|scenario=="sri_seedsap_270m"|scenario=="sri_fog_270m"|scenario=="sri_fog_adultyoung_270m"|scenario=="sri_fog_seedsap_270m"){
  #Santa Rosa

}else if (scenario=="sca_270m"){
  #Santa Catalina

}else if (scenario=="sca_int_270m"){
  #Santa Catalina Interpolated

}else if (scenario=="MainlandCA"){
  #Mainland CA

}else
  print ("No Scenario Selected")



```



Fog

```{r}

#Based on extent since only performing these for fog extent options

#Take fog layers-have to figure out how stored and how can for loop through
#Crop by extent
#Write asc raster for those fog options

#If else statements for scenarios: read in the correct data for each scenario
if (scenario=="scr_fog_270m"){
  #All Islands
  
}else if (scenario=="sri_fog_270m"|scenario=="sri_fog_adultyoung_270m"|scenario=="sri_fog_seedsap_270m"){
  #Santa Rosa

}else
  print ("No Fog Data Available")


```



Organization

```{r}

#Copy over code from BCM_organization but add in for all options made above but can select which of the variables actually should be carried over based on our decisions
#And based on scenario-some have fog and others dont and difference in oak points



```

